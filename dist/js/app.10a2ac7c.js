(function(){var e={3167:function(e,t,a){"use strict";var s=a(5130),l=a(6768),o=a(144),n=a.p+"img/callout.10de9efe.svg",r=a(4232);const i={class:"row"},u={class:"card h-100 shadow-sm"},c={class:"card-body text-center"},d=["src","alt"],m={class:"card-title"},p={class:"card-text",style:{"text-align":"left"}};function v(e,t,a,s,o,n){const v=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",i,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(e.columnList,(e=>((0,l.uX)(),(0,l.CE)("div",{key:e._id,class:"col-4 mb-4"},[(0,l.Lk)("div",u,[(0,l.Lk)("div",c,[(0,l.Lk)("img",{src:e.avatar&&e.avatar.url,alt:e.title,class:"shadow-sm rounded-circle border border-light my-3"},null,8,d),(0,l.Lk)("h5",m,(0,r.v_)(e.title),1),(0,l.Lk)("p",p,(0,r.v_)(e.description),1),(0,l.bF)(v,{to:`/column/${e._id}`,class:"btn btn-outline-primary"},{default:(0,l.k6)((()=>t[0]||(t[0]=[(0,l.eW)("进入专栏")]))),_:2},1032,["to"])])])])))),128))])}a(8111),a(1701),a(8237);function A(e,t,a,s=["m_pad"]){if(e&&e.url){const l=s.reduce(((e,t)=>t+","+e),"");e.fitUrl=e.url+`?x-oss-process=image/resize,${l}h_${a},w_${t}`}}function g(e,t,s){if(e.avatar)A(e.avatar,t,s);else{const t=e;e.avatar={fitUrl:a(t.title?8526:5003)}}}function b(e,t){const{format:a,size:s}=t,l=!a||a.includes(e.type),o=!s||e.size/1024/1024<s;let n=null;return l||(n="format"),o||(n="size"),{passed:o&&l,error:n}}const f=[{_id:"1",name:"a"},{_id:"2",name:"b"}],k=e=>e.reduce(((e,t)=>(t._id&&(e[t._id]=t),e)),{}),y=k(f);console.log(y);const h=e=>Object.keys(e).map((t=>e[t])),L={1:{_id:"1",name:"a"},2:{_id:"2",name:"b"}},C=h(L);console.log(C);var _=(0,l.pM)({name:"ColumnList",props:{list:{type:Array,required:!0}},setup(e){const t=(0,l.EW)((()=>e.list.map((e=>(g(e,50,50),e)))));return{columnList:t}}}),w=a(1241);const E=(0,w.A)(_,[["render",v],["__scopeId","data-v-3a8162b8"]]);var M=E,j=a(782);const x=(e,t,a={currentPage:2,pageSize:5})=>{const s=(0,j.Pj)(),n=(0,o.KR)(a.currentPage),r=(0,l.EW)((()=>({currentPage:n.value,pageSize:a.pageSize}))),i=()=>{s.dispatch(e,r.value).then((()=>{n.value++}))},u=(0,l.EW)((()=>Math.ceil(t.value/a.pageSize)===n.value));return{loadMorePage:i,isLastPage:u,currentPage:n}};var P=x;const I={class:"home-page"},B={class:"py-5 text-center container"},V={class:"row py-lg-5"},R={class:"col-lg-6 col-md-8 mx-auto"};var D=(0,l.pM)({__name:"Home",setup(e){const t=(0,j.Pj)(),a=(0,l.EW)((()=>t.getters.getColumns)),s=(0,l.EW)((()=>t.state.columns.total));(0,l.sV)((()=>{t.dispatch("fetchColumns",{page:3})}));const{loadMorePage:r,isLastPage:i}=P("fetchColumns",s,{pageSize:3,currentPage:2});return(e,t)=>{const s=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",I,[(0,l.Lk)("section",B,[(0,l.Lk)("div",V,[(0,l.Lk)("div",R,[t[2]||(t[2]=(0,l.Lk)("img",{src:n,alt:"callout",class:"w-50"},null,-1)),t[3]||(t[3]=(0,l.Lk)("h2",{class:"font-weight-light"},"随心写作，自由表达",-1)),(0,l.Lk)("p",null,[(0,l.bF)(s,{to:"/create",class:"btn btn-primary my-2"},{default:(0,l.k6)((()=>t[1]||(t[1]=[(0,l.eW)("开始写文章")]))),_:1})])])])]),t[4]||(t[4]=(0,l.Lk)("h4",{class:"font-weight-bold text-center"},"发现精彩",-1)),(0,l.bF)(M,{list:a.value},null,8,["list"]),(0,o.R1)(i)?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("button",{key:0,class:"btn btn-outline-primary mt-2 mb-5 mx-auto btn-block w-25",style:{display:"block","margin-left":"auto","margin-right":"auto"},onClick:t[0]||(t[0]=(...e)=>(0,o.R1)(r)&&(0,o.R1)(r)(...e))}," 加载更多 "))])}}});const Q=D;var F=Q,X=(a(4114),a(973)),S=(a(1148),a(595));const U={class:"validate-form-container"},O=(0,S.A)();var W=(0,l.pM)({__name:"ValidateForm",emits:["form-submit"],setup(e,{emit:t}){const a=t;let o=[];const n=()=>{const e=o.map((e=>e())).every((e=>e));a("form-submit",e)},r=e=>{e&&o.push(e)};return O.on("form-item-created",r),(0,l.hi)((()=>{O.off("form-item-created",r),o=[]})),(e,t)=>((0,l.uX)(),(0,l.CE)("form",U,[(0,l.RG)(e.$slots,"default"),(0,l.Lk)("div",{class:"submit-area",onClick:(0,s.D$)(n,["prevent"])},[(0,l.RG)(e.$slots,"submit",{},(()=>[t[0]||(t[0]=(0,l.Lk)("button",{type:"submit",class:"btn btn-primary"}," 提交 ",-1)),t[1]||(t[1]=(0,l.Lk)("br",null,null,-1))]))])]))}});const $=W;var q=$;const K={class:"validate-input-container pb-3"},N={key:2,class:"invalid-feedback"};var z=(0,l.pM)(Object.assign({inheritAttrs:!1},{__name:"ValidateInput",props:{rules:Array,modelValue:String,tag:{type:String,default:"input"}},emits:["update:modelValue"],setup(e,{emit:t}){(0,l.sV)((()=>{O.emit("form-item-created",d)}));const a=/^[a-zA-Z0-9_-]+@[a-zA-Z0-9_-]+(\.[a-zA-Z0-9_-]+)+$/,n=/^.*$/,i=e,u=t,c=(0,o.Kh)({val:(0,l.EW)({get:()=>i.modelValue||"",set:e=>{u("update:modelValue",e)}}),error:!1,message:""}),d=()=>{if(i.rules){const e=i.rules.every((e=>{let t=!0;switch(c.message=e.message,e.type){case"required":t=""!==c.val.trim();break;case"email":t=a.test(c.val);break;case"password":t=n.test(c.val),t||(c.val="");break;case"custom":t=!e.validator||e.validator();break;default:break}return t}));return c.error=!e,e}return!0};return console.log(c.val),(t,a)=>((0,l.uX)(),(0,l.CE)("div",K,["textarea"!==e.tag?(0,l.bo)(((0,l.uX)(),(0,l.CE)("input",(0,l.v6)({key:0,class:["form-control",{"is-invalid":c.error}],onBlur:d,"onUpdate:modelValue":a[0]||(a[0]=e=>c.val=e)},t.$attrs),null,16)),[[s.hp,c.val]]):(0,l.bo)(((0,l.uX)(),(0,l.CE)("textarea",(0,l.v6)({key:1,class:["form-control",{"is-invalid":c.error}],onBlur:d,"onUpdate:modelValue":a[1]||(a[1]=e=>c.val=e)},t.$attrs),null,16)),[[s.Jo,c.val]]),c.error?((0,l.uX)(),(0,l.CE)("span",N,(0,r.v_)(c.message),1)):(0,l.Q3)("",!0)]))}}));const G=z;var T=G;function H(e){const t=document.createElement("div");t.id=e,document.body.appendChild(t),(0,l.hi)((()=>{document.body.removeChild(t)}))}var Z=H;const J={class:""},Y=(0,l.pM)({name:"Message",props:{message:String}});var ee=(0,l.pM)(Object.assign(Object.assign({},Y),{props:{message:String,type:{type:String,default:"default"}},emits:["close-message"],setup(e,{emit:t}){const a=t,n=e;Z("message");const i=(0,o.KR)(!0),u={"alert-success":"success"===n.type,"alert-danger":"error"===n.type,"alert-primary":"default"===n.type},c=()=>{i.value=!1,a("close-message",!0)};return(t,a)=>((0,l.uX)(),(0,l.Wv)(l.Im,{to:"#message"},[i.value?((0,l.uX)(),(0,l.CE)("div",{key:0,class:(0,r.C4)(["alert message-info fixed-top w-50 mx-auto d-flex justify-content-between mt-2",u]),role:"alert"},[(0,l.Lk)("span",J,(0,r.v_)(e.message),1),(0,l.Lk)("button",{type:"button",class:"btn-close","data-bs-dismiss":"alert","aria-label":"Close",onClick:(0,s.D$)(c,["prevent"])})])):(0,l.Q3)("",!0)]))}}));const te=ee;var ae=te;const se=(e,t,a)=>{const o=(0,l.h)(ae,{message:e,type:t}),n=document.createElement("div");document.body.appendChild(n),(0,s.XX)(o,n);const r=()=>{(0,s.XX)(null,n),document.body.removeChild(n)};a&&setTimeout((()=>{r()}),a)};var le=se;const oe={class:"login-page"},ne={class:"mb-3"},re={class:"mb-3"};var ie=(0,l.pM)({__name:"Login",setup(e){const t=(0,X.rd)(),a=(0,j.Pj)(),s=(0,o.KR)(""),n=[{type:"required",message:"该项输入不能为空"},{type:"email",message:"请输入正确的电子邮箱格式"}],r=(0,o.KR)(""),i=[{type:"required",message:"该项输入不能为空"},{type:"password",message:"密码必须包含至少一个字母和一个数字，并且总长度不低于 6 位"}],u=e=>{if(e){const e={email:s.value,password:r.value};a.dispatch("loginAndFetch",e).then((()=>{le("登录成功，两秒后跳转到首页...","success",2e3),setTimeout((()=>{t.push("/")}),2e3)})).catch((e=>{console.log(e)}))}};return(e,t)=>((0,l.uX)(),(0,l.CE)("div",oe,[(0,l.bF)(q,{onFormSubmit:u},{submit:(0,l.k6)((()=>t[4]||(t[4]=[(0,l.Lk)("button",{type:"submit",class:"btn btn-primary btn-block btn-large"},"登录",-1)]))),default:(0,l.k6)((()=>[(0,l.Lk)("div",ne,[t[2]||(t[2]=(0,l.Lk)("label",{class:"form-label"},"邮箱地址",-1)),(0,l.bF)(T,{rules:n,modelValue:s.value,"onUpdate:modelValue":t[0]||(t[0]=e=>s.value=e),placeholder:"请输入邮箱地址",type:"text",ref:"inputRef"},null,8,["modelValue"])]),(0,l.Lk)("div",re,[t[3]||(t[3]=(0,l.Lk)("label",{class:"form-label"},"密码",-1)),(0,l.bF)(T,{type:"password",placeholder:"请输入密码",rules:i,modelValue:r.value,"onUpdate:modelValue":t[1]||(t[1]=e=>r.value=e)},null,8,["modelValue"])])])),_:1})]))}});const ue=ie;var ce=ue;const de={class:"post-list"},me={class:"card-body"},pe={class:"row my-3 align-items-center"},ve={key:0,class:"col-4"},Ae=["src","alt"],ge={class:"text-muted"};var be=(0,l.pM)({__name:"PostList",props:{list:{required:!0,type:Array}},setup(e){const t=e,a=(0,l.EW)((()=>t.list.map((e=>(A(e.image,200,110,["m_fill"]),e)))));return(e,t)=>{const s=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",de,[((0,l.uX)(!0),(0,l.CE)(l.FK,null,(0,l.pI)(a.value,(e=>((0,l.uX)(),(0,l.CE)("article",{key:e._id,class:"card mb-3 shadow-sm"},[(0,l.Lk)("div",me,[(0,l.Lk)("h4",null,[(0,l.bF)(s,{to:`/posts/${e._id}/`},{default:(0,l.k6)((()=>[(0,l.eW)((0,r.v_)(e.title),1)])),_:2},1032,["to"])]),(0,l.Lk)("div",pe,[e.image?((0,l.uX)(),(0,l.CE)("div",ve,[(0,l.Lk)("img",{src:e.image.fitUrl,alt:e.title,class:"rounded-lg w-100"},null,8,Ae)])):(0,l.Q3)("",!0),(0,l.Lk)("p",{class:(0,r.C4)([{"col-8":e.image},"text-muted"])},(0,r.v_)(e.excerpt),3)]),(0,l.Lk)("span",ge,(0,r.v_)(e.createdAt),1)])])))),128))])}}});const fe=(0,w.A)(be,[["__scopeId","data-v-a737d93a"]]);var ke=fe;const ye={class:"column-detail-page w-75 mx-auto"},he={key:0,class:"column-info row mb-4 border-bottom pb-4 align-items-center"},Le={class:"col-3 text-center"},Ce=["src","alt"],_e={class:"col-9"},we={class:"text-muted"};var Ee=(0,l.pM)({__name:"ColumnDetail",setup(e){const t=(0,X.lq)(),a=(0,j.Pj)(),s=t.params.id;(0,l.sV)((()=>{a.dispatch("fetchColumns",s),a.dispatch("fetchPosts",s)}));const o=(0,l.EW)((()=>{const e=a.getters.getColumnById(s);return e}));console.log(o);const n=(0,l.EW)((()=>a.getters.getPostsByCid(s)));return(e,t)=>((0,l.uX)(),(0,l.CE)("div",ye,[o.value?((0,l.uX)(),(0,l.CE)("div",he,[(0,l.Lk)("div",Le,[(0,l.Lk)("img",{src:o.value.avatar&&o.value.avatar.fitUrl,alt:o.value.title,class:"rounded-circle border w-100"},null,8,Ce)]),(0,l.Lk)("div",_e,[(0,l.Lk)("h4",null,(0,r.v_)(o.value.title),1),(0,l.Lk)("p",we,(0,r.v_)(o.value.description),1)])])):(0,l.Q3)("",!0),(0,l.bF)(ke,{list:n.value},null,8,["list"])]))}});const Me=Ee;var je=Me,xe=a(4373);const Pe={class:"file-upload"};var Ie=(0,l.pM)(Object.assign({inheritAttrs:!1},{__name:"Uploader",props:{action:{type:String,required:!0},beforeUpload:{type:Function},uploaded:{type:Object}},emits:["file-uploaded","file-uploaded-error"],setup(e,{emit:t}){const a=(0,o.KR)(null),n=e,r=t,i=(0,o.KR)(n.uploaded?"success":"ready"),u=(0,o.KR)(n.uploaded);(0,l.wB)((()=>n.uploaded),(e=>{e&&(i.value="success",u.value=e)}));const c=()=>{a.value&&a.value.click()},d=e=>{const t=e.target;if(t.files){const e=Array.from(t.files);if(n.beforeUpload){const t=n.beforeUpload(e[0]);if(!t)return}i.value="loading";const s=new FormData;s.append("file",e[0]),xe.A.post(n.action,s,{headers:{"Content-type":"multipart/form-data"}}).then((e=>{i.value="success",u.value=e.data,r("file-uploaded",e.data)})).catch((e=>{i.value="error",r("file-uploaded-error",{error:e})})).finally((()=>{a.value&&(a.value.value="")})),u.value||le("服务器响应错误,请稍后再试","error",2e3)}};return(e,t)=>((0,l.uX)(),(0,l.CE)("div",Pe,[(0,l.Lk)("div",(0,l.v6)({class:"file-upload-container",onClick:(0,s.D$)(c,["prevent"])},e.$attrs),["loading"===i.value?(0,l.RG)(e.$slots,"loading",{key:0},(()=>[t[0]||(t[0]=(0,l.Lk)("button",{class:"btn btn-primary",disabled:""},"正在上传...",-1))])):"success"===i.value?(0,l.RG)(e.$slots,"uploaded",{key:1,uploadedData:u.value},(()=>[t[1]||(t[1]=(0,l.Lk)("button",{class:"btn btn-primary"},"上传成功",-1))])):(0,l.RG)(e.$slots,"default",{key:2},(()=>[t[2]||(t[2]=(0,l.Lk)("button",{class:"btn btn-primary"},"点击上传",-1))]))],16),(0,l.Lk)("input",{type:"file",class:"file-input d-none",ref_key:"fileInput",ref:a,onChange:d},null,544)]))}}));const Be=Ie;var Ve=Be,Re=a(6123),De=a.n(Re);const Qe={class:"vue-easymde-editor"};var Fe=(0,l.pM)({__name:"Editor",props:{modelValue:{},options:{}},emits:["update:modelValue","change","blur"],setup(e,{expose:t,emit:a}){const s=e,n=a;(0,l.wB)((()=>s.modelValue),(e=>{i&&e!==u.value&&i.value(e||"")}));const r=(0,o.KR)(null);let i=null;const u=(0,o.KR)(s.modelValue||"");(0,l.sV)((()=>{if(r.value){const e=Object.assign(Object.assign({},s.options||{}),{element:r.value,initialValue:u.value});i=new(De())(e),i.codemirror.on("change",(()=>{if(i){const e=i.value();u.value=e,n("update:modelValue",e),n("change",e)}})),i.codemirror.on("blur",(()=>{i&&n("blur")}))}}));const c=()=>{i&&i.value("")},d=()=>i;return t({clear:c,getMDEInstance:d}),(0,l.hi)((()=>{i&&i.cleanup(),i=null})),(e,t)=>((0,l.uX)(),(0,l.CE)("div",Qe,[(0,l.Lk)("textarea",{ref_key:"textArea",ref:r},null,512)]))}});const Xe=Fe;var Se=Xe;const Ue={class:"create-post-page"},Oe=["src"],We={class:"mb-3"},$e={class:"mb-3"},qe={key:0,class:"invalid-feedback mt-1"},Ke={class:"btn btn-primary btn-large"};var Ne=(0,l.pM)({__name:"CreatePost",setup(e){const t=(0,o.Kh)({isValid:!0,message:""}),a=(0,o.KR)(),s=(0,X.rd)(),n=(0,j.Pj)(),i=(0,o.KR)("");let u="";const c=[{type:"required",message:"该项输入不能为空"}],d=(0,o.KR)(""),m=e=>{e.data._id&&(u=e.data._id)},p=(0,o.KR)(),v=(0,X.lq)(),A=!!v.query.id,g={spellChecker:!1},f=()=>{""===d.value.trim()?(t.isValid=!1,t.message="文章详情不能为空"):(t.isValid=!0,t.message="")};(0,l.sV)((()=>{a.value&&console.log(a.value.getMDEInstance()),A&&n.dispatch("fetchPost",v.query.id).then((e=>{const t=e.data;t.image&&(p.value={data:t.image}),i.value=t.title,d.value=t.content||""}))}));const k=e=>{if(f(),e&&t.isValid){const{column:e,_id:t}=n.state.user;if(e){const a={title:i.value,content:d.value,column:e,author:t};u&&(a.image=u);const l=A?"updatePost":"createPost",o=A?{id:v.query.id,payload:a}:a;n.dispatch(l,o).then((()=>{le("发表成功, 2秒后跳转到文章","success",2e3),setTimeout((()=>{s.push({name:"column",params:{id:e}})}),2e3)}))}}},y=e=>{const t=b(e,{format:["image/jpeg","image/png"],size:1}),{passed:a,error:s}=t;return console.log(a),"format"===s&&le("上传图片只能是 JPG/PNG 格式","error",2e3),"size"===s&&le("上传图片大小不能超过 1Mb","error",2e3),a};return(e,s)=>((0,l.uX)(),(0,l.CE)("div",Ue,[(0,l.Lk)("h4",null,(0,r.v_)(A?"编辑文章":"新建文章"),1),(0,l.bF)(Ve,{action:"/upload",class:"d-flex align-items-center justify-content-center bg-light text-secondary w-100 my-4","before-upload":y,onFileUploaded:m,uploaded:p.value},{loading:(0,l.k6)((()=>s[2]||(s[2]=[(0,l.Lk)("div",{class:"d-flex"},[(0,l.Lk)("div",{class:"spinner-border text-secondary",role:"status"}),(0,l.Lk)("span",null,"   "),(0,l.Lk)("h2",null,"正在上传")],-1)]))),uploaded:(0,l.k6)((e=>[(0,l.Lk)("img",{src:e.uploadedData.data.url,alt:""},null,8,Oe)])),default:(0,l.k6)((()=>[s[3]||(s[3]=(0,l.Lk)("h4",null,"点击上传头图",-1))])),_:1},8,["uploaded"]),(0,l.bF)(q,{onFormSubmit:k},{submit:(0,l.k6)((()=>[(0,l.Lk)("button",Ke,(0,r.v_)(A?"更新文章":"发表文章"),1)])),default:(0,l.k6)((()=>[(0,l.Lk)("div",We,[s[4]||(s[4]=(0,l.Lk)("label",{for:"form-label"},"文章标题:",-1)),(0,l.bF)(T,{rules:c,modelValue:i.value,"onUpdate:modelValue":s[0]||(s[0]=e=>i.value=e),placeholder:"请输入文章标题",type:"text"},null,8,["modelValue"])]),(0,l.Lk)("div",$e,[s[5]||(s[5]=(0,l.Lk)("label",{for:"form-label"},"文章详情:",-1)),(0,l.bF)(Se,{modelValue:d.value,"onUpdate:modelValue":s[1]||(s[1]=e=>d.value=e),options:g,ref_key:"editorRef",ref:a,onBlur:f,class:(0,r.C4)({"is-invalid":!t.isValid})},null,8,["modelValue","class"]),t.isValid?(0,l.Q3)("",!0):((0,l.uX)(),(0,l.CE)("span",qe,(0,r.v_)(t.message),1))])])),_:1})]))}});const ze=Ne;var Ge=ze;const Te={class:"signup-page mx-auto p-3 w-330"},He={class:"mb-3"},Ze={class:"mb-3"},Je={class:"mb-3"},Ye={class:"mb-3"};var et=(0,l.pM)({__name:"Signup",setup(e){const t=(0,o.Kh)({email:"",nickName:"",password:"",repeatPassword:""}),a=(0,X.rd)(),s=[{type:"required",message:"电子邮箱地址不能为空"},{type:"email",message:"请输入正确的电子邮箱格式"}],n=[{type:"required",message:"昵称不能为空"}],r=[{type:"required",message:"密码不能为空"},{type:"password",message:"密码必须包含至少一个字母和一个数字，并且总长度不低于 6 位"}],i=[{type:"required",message:"重复密码不能为空"},{type:"custom",validator:()=>t.password===t.repeatPassword,message:"密码不相同"}],u=e=>{if(e){const e={email:t.email,password:t.password,nickName:t.nickName};xe.A.post("/users/",e).then((()=>{le("注册成功 正在跳转登录页面","success",2e3),setTimeout((()=>{a.push("/login")}),2e3)})).catch((e=>{console.log(e)}))}};return(e,a)=>((0,l.uX)(),(0,l.CE)("div",Te,[a[9]||(a[9]=(0,l.Lk)("h5",{class:"my-4 text-center"},"注册云圈账户",-1)),(0,l.bF)(q,{onFormSubmit:u},{submit:(0,l.k6)((()=>a[8]||(a[8]=[(0,l.Lk)("button",{type:"submit",class:"btn btn-primary btn-block btn-large"},"注册新用户",-1)]))),default:(0,l.k6)((()=>[(0,l.Lk)("div",He,[a[4]||(a[4]=(0,l.Lk)("label",{class:"form-label"},"邮箱地址",-1)),(0,l.bF)(T,{rules:s,modelValue:t.email,"onUpdate:modelValue":a[0]||(a[0]=e=>t.email=e),placeholder:"请输入邮箱地址",type:"text"},null,8,["modelValue"])]),(0,l.Lk)("div",Ze,[a[5]||(a[5]=(0,l.Lk)("label",{class:"form-label"},"昵称",-1)),(0,l.bF)(T,{rules:n,modelValue:t.nickName,"onUpdate:modelValue":a[1]||(a[1]=e=>t.nickName=e),placeholder:"请输入昵称",type:"text"},null,8,["modelValue"])]),(0,l.Lk)("div",Je,[a[6]||(a[6]=(0,l.Lk)("label",{class:"form-label"},"密码",-1)),(0,l.bF)(T,{type:"password",placeholder:"请输入密码",rules:r,modelValue:t.password,"onUpdate:modelValue":a[2]||(a[2]=e=>t.password=e)},null,8,["modelValue"])]),(0,l.Lk)("div",Ye,[a[7]||(a[7]=(0,l.Lk)("label",{class:"form-label"},"重复密码",-1)),(0,l.bF)(T,{type:"password",placeholder:"请再次密码",rules:i,modelValue:t.repeatPassword,"onUpdate:modelValue":a[3]||(a[3]=e=>t.repeatPassword=e)},null,8,["modelValue"])])])),_:1})]))}});const tt=et;var at=tt,st=a(357);const lt={class:"user-profile-component"},ot={class:"d-flex align-items-center"},nt=["src","alt"],rt={class:"detail ml-2"},it={class:"d-block mb-0"},ut={class:"text-truncate text-muted d-block"};function ct(e,t,a,s,o,n){return(0,l.uX)(),(0,l.CE)("div",lt,[(0,l.Lk)("div",ot,[(0,l.Lk)("img",{src:e.fitUrl,alt:e.user.nickName,class:"rounded-circle img-thumbnail"},null,8,nt),(0,l.Lk)("div",rt,[(0,l.Lk)("h6",it,(0,r.v_)(e.user.nickName),1),(0,l.Lk)("span",ut,(0,r.v_)(e.user.description),1)])])])}var dt=(0,l.pM)({props:{user:{type:Object,required:!0}},setup(e){const t=(0,l.EW)((()=>{g(e.user,50,50);const{avatar:t}=e.user;return t&&t.fitUrl}));return{fitUrl:t}}});const mt=(0,w.A)(dt,[["render",ct]]);var pt=mt;const vt={key:0,class:"modal d-block",tabindex:"-1"},At={class:"modal-dialog"},gt={class:"modal-content"},bt={class:"modal-header"},ft={class:"modal-title"},kt={class:"modal-body"};var yt=(0,l.pM)({__name:"Modal",props:{title:String,visible:{type:Boolean,default:!1}},emits:["modal-on-close","modal-on-confirm"],setup(e,{emit:t}){const a=t;Z("modal");const s=()=>{a("modal-on-close"),console.log("关闭关闭")},o=()=>{a("modal-on-confirm"),console.log("确定")};return(t,a)=>((0,l.uX)(),(0,l.Wv)(l.Im,{to:"#modal"},[e.visible?((0,l.uX)(),(0,l.CE)("div",vt,[(0,l.Lk)("div",At,[(0,l.Lk)("div",gt,[(0,l.Lk)("div",bt,[(0,l.Lk)("h5",ft,(0,r.v_)(e.title),1),(0,l.Lk)("button",{type:"button",class:"btn-close","data-dismiss":"modal","aria-label":"Close",onClick:s})]),(0,l.Lk)("div",kt,[(0,l.RG)(t.$slots,"default")]),(0,l.Lk)("div",{class:"modal-footer"},[(0,l.Lk)("button",{type:"button",class:"btn btn-secondary","data-dismiss":"modal",onClick:s},"取消"),(0,l.Lk)("button",{type:"button",class:"btn btn-primary",onClick:o},"确定")])])])])):(0,l.Q3)("",!0)]))}});const ht=yt;var Lt=ht;const Ct={class:"post-detail-page"},_t={key:0,class:"w-75 mx-auto mb-5 pb-3"},wt=["src"],Et={class:"mb-4"},Mt={class:"user-profile-component border-top border-bottom py-3 mb-5 align-items-center row g-0"},jt={class:"col"},xt={class:"text-muted col text-right font-italic"},Pt=["innerHTML"],It={key:1,class:"btn-group mt-5"};var Bt=(0,l.pM)({__name:"PostDetail",setup(e){const t=(0,j.Pj)(),a=(0,X.lq)(),n=(0,X.rd)(),i=(0,o.KR)(!1),u=a.params.id;(0,l.sV)((()=>{t.dispatch("fetchPost",u)}));const c=(0,l.EW)((()=>t.getters.getCurrentPost(u))),d=(0,l.EW)((()=>{if(c.value&&c.value.content){const{isHTML:e,content:t}=c.value;return e?t:st.xI.parse(t)}return""})),m=(0,l.EW)((()=>{const{isLogin:e,_id:a}=t.state.user;if(c.value&&c.value.author&&e){const e=c.value.author;return e._id===a}return!1})),p=(0,l.EW)((()=>{if(c.value&&c.value.image){const{image:e}=c.value;return e.url+"?x-oss-process=image/resize,w_850"}return null})),v=()=>{i.value=!1,t.dispatch("deletePost",u).then((e=>{le("删除成功, 2秒后跳转到专栏首页","success",2e3),setTimeout((()=>{n.push({name:"column",params:{id:e.data.column}})}),2e3)})).catch((e=>{console.log("报错了",e)}))};return(e,t)=>{const a=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("div",Ct,[(0,l.bF)(Lt,{title:"删除文章",visible:i.value,onModalOnClose:t[0]||(t[0]=e=>i.value=!1),onModalOnConfirm:v},{default:(0,l.k6)((()=>t[2]||(t[2]=[(0,l.Lk)("p",null,"确定要删除这篇文章吗",-1)]))),_:1},8,["visible"]),c.value?((0,l.uX)(),(0,l.CE)("article",_t,[p.value?((0,l.uX)(),(0,l.CE)("img",{key:0,src:p.value,alt:"currentPost.title",class:"rounded-lg img-fluid my-4"},null,8,wt)):(0,l.Q3)("",!0),(0,l.Lk)("h2",Et,(0,r.v_)(c.value.title),1),(0,l.Lk)("div",Mt,[(0,l.Lk)("div",jt,["object"===typeof c.value.author?((0,l.uX)(),(0,l.Wv)(pt,{key:0,user:c.value.author},null,8,["user"])):(0,l.Q3)("",!0)]),(0,l.Lk)("span",xt,"发表于："+(0,r.v_)(c.value.createdAt),1)]),(0,l.Lk)("div",{innerHTML:d.value},null,8,Pt),m.value?((0,l.uX)(),(0,l.CE)("div",It,[(0,l.bF)(a,{type:"button",class:"btn btn-success",to:{name:"create",query:{id:c.value._id}}},{default:(0,l.k6)((()=>t[3]||(t[3]=[(0,l.eW)("编辑")]))),_:1},8,["to"]),(0,l.Lk)("button",{type:"button",class:"btn btn-danger",onClick:t[1]||(t[1]=(0,s.D$)((e=>i.value=!0),["prevent"]))},"删除")])):(0,l.Q3)("",!0)])):(0,l.Q3)("",!0)])}}});const Vt=Bt;var Rt=Vt,Dt=(a(2489),a(8542));const Qt=(e,t,a,...s)=>(0,Dt.sH)(void 0,[e,t,a,...s],void 0,(function*(e,t,a,s={method:"get"},l){const{data:o}=yield(0,xe.A)(e,s);return a(t,l?{data:o,extraData:l}:o),o})),Ft=(0,j.y$)({state:{token:localStorage.getItem("token")||"",error:{status:!1},loading:!1,columns:{data:{},isLoaded:!1,total:0},posts:{data:{},loadedColumns:[]},user:{isLogin:!1}},mutations:{createPost(e,t){e.posts.data[t._id]=t},fetchColumns(e,t){const{data:a}=e.columns,{list:s,count:l}=t.data;e.columns={data:Object.assign(Object.assign({},a),k(s)),total:l,isLoaded:!0}},fetchColumn(e,t){e.columns.data[t.data._id]=t.data},fetchPosts(e,{data:t,extraData:a}){e.posts.data=Object.assign(Object.assign({},e.posts.data),k(t.data.list)),e.posts.loadedColumns.push(a)},fetchPost(e,t){e.posts.data[t.data._id]=t.data},deletePost(e,{data:t}){delete e.posts.data[t._id]},updatePost(e,{data:t}){e.posts.data[t._id]=t},setLoading(e,t){e.loading=t},setError(e,t){e.error=t},fetchCurrentUser(e,t){e.user=Object.assign({isLogin:!0},t.data)},login(e,t){const{token:a}=t.data;e.token=a,localStorage.setItem("token",a),xe.A.defaults.headers.common.Authorization=`Bearer ${a}`},logout(e){e.token="",e.user={isLogin:!1},localStorage.removeItem("token"),delete xe.A.defaults.headers.common.Authorization}},actions:{fetchColumns({state:e,commit:t},a={}){const{currentPage:s=1,pageSize:l=6}=a;return Qt(`/columns?currentPage=${s}&pageSize=${l}`,"fetchColumns",t)},fetchColumn({state:e,commit:t},a){if(!e.columns.data[a])return Qt(`/columns/${a}`,"fetchColumn",t)},fetchPosts({state:e,commit:t},a){if(!e.posts.loadedColumns.includes(a))return Qt(`/columns/${a}/posts`,"fetchPosts",t,{method:"get"},a)},fetchPost({state:e,commit:t},a){const s=e.posts.data[a];return s&&s.content?Promise.resolve({data:s}):Qt(`/posts/${a}`,"fetchPost",t)},updatePost({commit:e},{id:t,payload:a}){return Qt(`/posts/${t}`,"updatePost",e,{method:"patch",data:a})},fetchCurrentUser({commit:e}){return Qt("/user/current","fetchCurrentUser",e)},login({commit:e},t){return Qt("/user/login","login",e,{method:"post",data:t})},createPost({commit:e},t){return Qt("/posts","createPost",e,{method:"post",data:t})},deletePost({commit:e},t){return Qt(`/posts/${t}`,"deletePost",e,{method:"delete"})},loginAndFetch({dispatch:e},t){return e("login",t).then((()=>e("fetchCurrentUser")))}},getters:{getColumns:e=>h(e.columns.data),getColumnById:e=>t=>e.columns.data[t],getPostsByCid:e=>t=>h(e.posts.data).filter((e=>e.column===t)),getCurrentPost:e=>t=>e.posts.data[t]}});var Xt=Ft;const St=(0,X.LA)(),Ut=(0,X.aE)({history:St,routes:[{path:"/",name:"home",component:F},{path:"/login",name:"login",component:ce,meta:{redirectAlreadyLogin:!0}},{path:"/create",name:"CreatePost",component:Ge,meta:{requiredLogin:!0}},{path:"/column/:id",name:"column",component:je},{path:"/signup",name:"signup",component:at},{path:"/posts/:id",name:"post",component:Rt},{path:"/create/:id",name:"create",component:Ge,props:!0}],scrollBehavior(){return{top:0}}});Ut.beforeEach(((e,t,a)=>{const{user:s,token:l}=Xt.state,{requiredLogin:o,redirectAlreadyLogin:n}=e.meta;s.isLogin?n?a("/"):a():l?(xe.A.defaults.headers.common.Authorization=`Bearer ${l}`,Xt.dispatch("fetchCurrentUser").then((()=>{n?a("/"):a()})).catch((e=>{console.error(e),Xt.commit("logout"),a("login")}))):o?a("/"):a()}));var Ot=Ut,Wt=(0,l.pM)({__name:"DropDownItem",props:{disable:{type:Boolean,default:!1}},setup(e){return(t,a)=>((0,l.uX)(),(0,l.CE)("li",{class:(0,r.C4)(["dropdown-option",{"is-disable":e.disable}])},[(0,l.RG)(t.$slots,"default")],2))}});const $t=Wt;var qt=$t;const Kt=e=>{const t=(0,o.KR)(!1),a=a=>{e.value&&(e.value.contains(a.target)?t.value=!1:t.value=!0)};return(0,l.sV)((()=>{document.addEventListener("click",a)})),(0,l.hi)((()=>{document.removeEventListener("click",a)})),t};var Nt=Kt;const zt={key:0,class:"dropdown-menu menu",style:{display:"block"}};var Gt=(0,l.pM)({__name:"DropDown",props:{title:{type:String,Required:!0}},setup(e){const t=(0,o.KR)(null),a=(0,o.KR)(!1),n=Nt(t);(0,l.wB)(n,(()=>{a.value&&n.value&&(a.value=!1)}));const i=()=>{a.value=!a.value};return(o,n)=>((0,l.uX)(),(0,l.CE)("div",{class:"dropdown",ref_key:"dropdownRef",ref:t},[(0,l.Lk)("a",{href:"#",class:"btn btn-outline-light my-2 dropdown-toggle",onClick:(0,s.D$)(i,["prevent"])},(0,r.v_)(e.title),1),a.value?((0,l.uX)(),(0,l.CE)("ul",zt,[(0,l.RG)(o.$slots,"default")])):(0,l.Q3)("",!0)],512))}});const Tt=Gt;var Ht=Tt;const Zt={class:"navbar navbar-dark bg-info bg-gradient justify-content-between mb-4 px-4"},Jt={key:0,class:"list-inline mb-0"},Yt={class:"list-inline-item"},ea={class:"list-inline-item"},ta={key:1,class:"list-inline mb-0"},aa={class:"list-inline-item"};var sa=(0,l.pM)({__name:"GloballHeader",props:{user:{type:Object,required:!0}},setup(e){const t=(0,X.rd)(),a=(0,j.Pj)(),s=()=>{a.commit("logout"),le("登出成功, 两秒后跳转至首页...","success",2e3),setTimeout((()=>{t.push("/")}),2e3)};return(t,a)=>{const o=(0,l.g2)("router-link");return(0,l.uX)(),(0,l.CE)("nav",Zt,[a[5]||(a[5]=(0,l.Lk)("a",{href:"#",class:"navbar-brand fw-light fs-3"},"云圈",-1)),e.user.isLogin?((0,l.uX)(),(0,l.CE)("ul",ta,[(0,l.Lk)("li",aa,[(0,l.bF)(Ht,{title:`你好 ${e.user.nickName}`},{default:(0,l.k6)((()=>[(0,l.bF)(qt,null,{default:(0,l.k6)((()=>[(0,l.bF)(o,{to:"/create",class:"dropdown-item"},{default:(0,l.k6)((()=>a[2]||(a[2]=[(0,l.eW)("新建文章")]))),_:1})])),_:1}),(0,l.bF)(qt,null,{default:(0,l.k6)((()=>[(0,l.bF)(o,{to:`/column/${e.user.column}`,class:"dropdown-item"},{default:(0,l.k6)((()=>a[3]||(a[3]=[(0,l.eW)("我的云层")]))),_:1},8,["to"])])),_:1}),(0,l.bF)(qt,null,{default:(0,l.k6)((()=>a[4]||(a[4]=[(0,l.Lk)("a",{href:"#",class:"dropdown-item"},"编辑资料",-1)]))),_:1}),(0,l.bF)(qt,null,{default:(0,l.k6)((()=>[(0,l.Lk)("span",{class:"dropdown-item",onClick:s},"退出登录")])),_:1})])),_:1},8,["title"])])])):((0,l.uX)(),(0,l.CE)("ul",Jt,[(0,l.Lk)("li",Yt,[(0,l.bF)(o,{to:"/login",class:"btn btn-outline-light my-2"},{default:(0,l.k6)((()=>a[0]||(a[0]=[(0,l.eW)("登录")]))),_:1})]),(0,l.Lk)("li",ea,[(0,l.bF)(o,{to:"/Signup",class:"btn btn-outline-light my-2"},{default:(0,l.k6)((()=>a[1]||(a[1]=[(0,l.eW)("注册")]))),_:1})])]))])}}});const la=sa;var oa=la;const na={class:"loading-content"},ra={class:"spinner-grow",role:"status"},ia={class:"visually-hidden sr-only"},ua={key:0,class:"fs-4 text-dark small"};var ca=(0,l.pM)({__name:"Loader",props:{text:{type:String},background:{type:String}},setup(e){const t=document.createElement("div");return t.id="back",document.body.appendChild(t),(0,l.hi)((()=>{document.body.removeChild(t)})),(t,a)=>((0,l.uX)(),(0,l.Wv)(l.Im,{to:"#back"},[(0,l.Lk)("div",{class:"d-flex justify-content-center align-items-center h-100 loading-container",style:(0,r.Tr)({backgroundColor:e.background||""})},[(0,l.Lk)("div",na,[(0,l.Lk)("div",ra,[(0,l.Lk)("span",ia,(0,r.v_)(e.text||"loading"),1)]),e.text?((0,l.uX)(),(0,l.CE)("p",ua,(0,r.v_)(e.text),1)):(0,l.Q3)("",!0)])],4)]))}});const da=ca;var ma=da;const pa={class:"container"};var va=(0,l.pM)({__name:"App",setup(e){(0,l.pM)({name:"App",components:{}});const t=(0,j.Pj)(),a=(0,l.EW)((()=>t.state.user)),s=(0,l.EW)((()=>t.state.loading)),o=(0,l.EW)((()=>t.state.error));return(0,l.wB)((()=>o.value.status),(()=>{const{status:e,message:t}=o.value;e&&t&&le(t,"error",3e3)})),(e,t)=>{const o=(0,l.g2)("router-view");return(0,l.uX)(),(0,l.CE)("div",pa,[(0,l.bF)(oa,{user:a.value},null,8,["user"]),s.value?((0,l.uX)(),(0,l.Wv)(ma,{key:0,text:"🦜玩命加载中🦜"})):(0,l.Q3)("",!0),(0,l.bF)(o),t[0]||(t[0]=(0,l.Fv)('<footer class="text-center py-4 text-secondary bg-light mt-6"><small><ul class="list-inline mb-0"><li class="list-inline-item">© 云圈-找到你的热爱</li><li class="list-inline-item">投诉</li><li class="list-inline-item">文档</li><li class="list-inline-item">联系</li><li class="list-inline-item">更多</li></ul></small></footer>',1))])}}});const Aa=va;var ga=Aa;xe.A.defaults.baseURL="http://api.vikingship.xyz/api",xe.A.interceptors.request.use((e=>(Xt.commit("setLoading",!0),Xt.commit("setError",{status:!1,message:""}),e))),xe.A.interceptors.response.use((e=>(Xt.commit("setLoading",!1),e)),(e=>{const{error:t}=e.response.data;return Xt.commit("setError",{status:!0,message:t}),Xt.commit("setLoading",!1),Promise.reject(t)}));const ba=(0,s.Ef)(ga);ba.use(Ot),ba.use(Xt),ba.mount("#app")},5003:function(e){"use strict";e.exports="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCAAyADIDASIAAhEBAxEB/8QAGgABAQADAQEAAAAAAAAAAAAAAAUBAgMEB//EAC8QAAIBAgMDCgcAAAAAAAAAAAABAgMRBBIxIUGhBRMyNFFhcpHB8BRScbHC0eH/xAAUAQEAAAAAAAAAAAAAAAAAAAAA/8QAFBEBAAAAAAAAAAAAAAAAAAAAAP/aAAwDAQACEQMRAD8A+zgAAAYctun8AyAAAAAN2tfS4nTlRhTlN3jOKeZ9ttGaVXalLwv7FqKyxS7EBIjGc+hTlL6L104nqw+Ellq88ks6UUk9q1d+PA7YulWrUlGhV5qWZNvuPRuAk4rDzwuGlVdSDtayyvbxJvxlVWd4Ndli5ynBTwFROST1V97ItDCu6lNWtu/YHrc7OwNsqAGtXocPPZ6lsitZqlOPzTiuN/QtAAABJxSc8bUzNvK7R7lZaeZqlY6Yrrk/e5HMAAAM0eu0PH+LK4AAAAS8V12fvcjmAAAAH//Z"},8526:function(e){"use strict";e.exports="data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAgGBgcGBQgHBwcJCQgKDBQNDAsLDBkSEw8UHRofHh0aHBwgJC4nICIsIxwcKDcpLDAxNDQ0Hyc5PTgyPC4zNDL/2wBDAQkJCQwLDBgNDRgyIRwhMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjL/wAARCAAyADIDASIAAhEBAxEB/8QAGQABAQEBAQEAAAAAAAAAAAAAAAMEAQUH/8QAKhAAAgIBAgMGBwAAAAAAAAAAAAECAxEEEiFBURQxU3GR4RNCUmFik+L/xAAVAQEBAAAAAAAAAAAAAAAAAAAAAf/EABQRAQAAAAAAAAAAAAAAAAAAAAD/2gAMAwEAAhEDEQA/APrwB2MXKSjFZb5FRwFlpL33Vt+Q7Jf4UgIgpZRZUk5waTJgAAANehlXCc52NJJYyzIWr4Vp9Zdei9wN2/QZ+T0Y36D8fRmPcvq4efuN33Xr/RFaNTOj4DdGzPc8LkeeXbTUuOcxfPyfUgVAAACtVsIRcZ1Kcc5XHGCQA1rV1xSSpkkuStZ3tsPBl+1mMAXndVtaroUG1jO5sgAAAAAAAAAAAAAAAf/Z"},8986:function(){}},t={};function a(s){var l=t[s];if(void 0!==l)return l.exports;var o=t[s]={exports:{}};return e[s].call(o.exports,o,o.exports,a),o.exports}a.m=e,function(){var e=[];a.O=function(t,s,l,o){if(!s){var n=1/0;for(c=0;c<e.length;c++){s=e[c][0],l=e[c][1],o=e[c][2];for(var r=!0,i=0;i<s.length;i++)(!1&o||n>=o)&&Object.keys(a.O).every((function(e){return a.O[e](s[i])}))?s.splice(i--,1):(r=!1,o<n&&(n=o));if(r){e.splice(c--,1);var u=l();void 0!==u&&(t=u)}}return t}o=o||0;for(var c=e.length;c>0&&e[c-1][2]>o;c--)e[c]=e[c-1];e[c]=[s,l,o]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){a.p="/"}(),function(){var e={524:0};a.O.j=function(t){return 0===e[t]};var t=function(t,s){var l,o,n=s[0],r=s[1],i=s[2],u=0;if(n.some((function(t){return 0!==e[t]}))){for(l in r)a.o(r,l)&&(a.m[l]=r[l]);if(i)var c=i(a)}for(t&&t(s);u<n.length;u++)o=n[u],a.o(e,o)&&e[o]&&e[o][0](),e[o]=0;return a.O(c)},s=self["webpackChunkyuncle"]=self["webpackChunkyuncle"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=a.O(void 0,[504],(function(){return a(3167)}));s=a.O(s)})();
//# sourceMappingURL=app.10a2ac7c.js.map